From 5d4c212a4ddc7ac987c0c9badf968dce06a5ae99 Mon Sep 17 00:00:00 2001
From: Matthias Kuhn <matthias@opengis.ch>
Date: Thu, 10 Feb 2022 07:40:15 +0100
Subject: [PATCH] P2

---
 cmake/modules/QcaMacro.cmake  | 4 ----
 plugins/qca-ossl/qca-ossl.cpp | 6 ++++++
 2 files changed, 6 insertions(+), 4 deletions(-)

diff --git a/cmake/modules/QcaMacro.cmake b/cmake/modules/QcaMacro.cmake
index 94f2562d..45031b95 100644
--- a/cmake/modules/QcaMacro.cmake
+++ b/cmake/modules/QcaMacro.cmake
@@ -65,10 +65,6 @@ macro(add_qca_test TARGET DESCRIPTION)
 endmacro(add_qca_test)
 
 macro(install_pdb TARGET INSTALL_PATH)
-  if(MSVC)
-    install(FILES $<TARGET_PDB_FILE:${TARGET}> DESTINATION ${INSTALL_PATH} CONFIGURATIONS Debug)
-    install(FILES $<TARGET_PDB_FILE:${TARGET}> DESTINATION ${INSTALL_PATH} CONFIGURATIONS RelWithDebInfo)
-  endif()
 endmacro(install_pdb)
 
 macro(normalize_path PATH)
diff --git a/plugins/qca-ossl/qca-ossl.cpp b/plugins/qca-ossl/qca-ossl.cpp
index d5f9eca8..11e3e8fa 100644
--- a/plugins/qca-ossl/qca-ossl.cpp
+++ b/plugins/qca-ossl/qca-ossl.cpp
@@ -6853,6 +6853,7 @@ public:
         else if (type == QLatin1String("aes256-ccm"))
             return new opensslCipherContext(EVP_aes_256_ccm(), 0, this, type);
 #endif
+#ifndef OPENSSL_NO_BF
         else if (type == QLatin1String("blowfish-ecb"))
             return new opensslCipherContext(EVP_bf_ecb(), 0, this, type);
         else if (type == QLatin1String("blowfish-cfb"))
@@ -6863,6 +6864,8 @@ public:
             return new opensslCipherContext(EVP_bf_cbc(), 0, this, type);
         else if (type == QLatin1String("blowfish-cbc-pkcs7"))
             return new opensslCipherContext(EVP_bf_cbc(), 1, this, type);
+#endif
+#ifndef OPENSSL_NO_DES
         else if (type == QLatin1String("tripledes-ecb"))
             return new opensslCipherContext(EVP_des_ede3(), 0, this, type);
         else if (type == QLatin1String("tripledes-cbc"))
@@ -6879,6 +6882,8 @@ public:
             return new opensslCipherContext(EVP_des_cfb(), 0, this, type);
         else if (type == QLatin1String("des-ofb"))
             return new opensslCipherContext(EVP_des_ofb(), 0, this, type);
+#endif
+#ifndef OPENSSL_NO_CAST
         else if (type == QLatin1String("cast5-ecb"))
             return new opensslCipherContext(EVP_cast5_ecb(), 0, this, type);
         else if (type == QLatin1String("cast5-cbc"))
@@ -6889,6 +6894,7 @@ public:
             return new opensslCipherContext(EVP_cast5_cfb(), 0, this, type);
         else if (type == QLatin1String("cast5-ofb"))
             return new opensslCipherContext(EVP_cast5_ofb(), 0, this, type);
+#endif
         else if (type == QLatin1String("pkey"))
             return new MyPKeyContext(this);
         else if (type == QLatin1String("dlgroup"))
-- 
2.34.1

